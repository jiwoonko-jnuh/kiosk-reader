<html lang="ko"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ìŒì„± ì¸ì‹ í‚¤ì˜¤ìŠ¤í¬ â€“ ë°ëª¨</title>
    <style>
      :root { --bg:#0b1220; --panel:#101a2e; --accent:#6aa7ff; --text:#e9eefb; --muted:#9fb0d8; --ok:#2ecc71; --warn:#ffb020; --err:#ff6b6b; }
      *{box-sizing:border-box}
      body{margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, Arial, sans-serif; background:linear-gradient(180deg, #0a0f1c, #0b1220 35%, #0b1220); color:var(--text)}
      .container{max-width:1050px; margin:32px auto; padding:16px}
      .grid{display:grid; grid-template-columns: 360px 1fr; gap:20px}
      .card{background:var(--panel); border:1px solid rgba(255,255,255,.06); border-radius:16px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.25)}
      .card h2{margin:0; padding:16px 18px; font-size:18px; border-bottom:1px solid rgba(255,255,255,.06); color:#cfe2ff}
      .card .content{padding:16px 18px}
      .menu{display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:12px}
      .menu .item{border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px; cursor:pointer; transition:.2s transform, .2s border-color}
      .menu .item:hover{transform:translateY(-2px); border-color:var(--accent)}
      .item .name{font-weight:700}
      .item .desc{font-size:12px; color:var(--muted)}
      .toolbar{display:flex; gap:12px; flex-wrap:wrap}
      button{all:unset; display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:#0e1730; cursor:pointer; transition:.15s transform, .2s border-color}
      button:hover{transform:translateY(-1px); border-color:var(--accent)}
      button.primary{background:linear-gradient(180deg, #1b4bff, #306dff); border-color:transparent}
      button.danger{background:linear-gradient(180deg, #ff4b4b, #ff6b6b)}
      .status{font-size:13px; color:var(--muted)}
      .status.ok{color:var(--ok)}
      .status.warn{color:var(--warn)}
      .status.err{color:var(--err)}
      .asr-box{min-height:72px; border:1px dashed rgba(255,255,255,.2); border-radius:12px; padding:10px 12px; background:#0d172b}
      .asr-box .label{font-size:12px; color:var(--muted)}
      .asr-box .text{font-size:16px; margin-top:4px; min-height:24px}
      table{width:100%; border-collapse:collapse}
      th, td{padding:10px 8px; border-bottom:1px solid rgba(255,255,255,.08)}
      th{color:#c9dcff; text-align:left; font-weight:600; font-size:13px}
      tfoot td{border-top:1px solid rgba(255,255,255,.2); font-weight:700}
      .pill{display:inline-block; padding:2px 8px; border-radius:999px; background:rgba(255,255,255,.08); font-size:12px; color:#cfe2ff}
      .hint{font-size:12px; color:var(--muted)}
      .footer{margin-top:12px; font-size:12px; color:var(--muted)}
      .big{font-size:40px; line-height:1}
      .center{display:flex; align-items:center; gap:12px}
      .sr-only{position:absolute; left:-10000px}
    </style>
  </head>
  <body>
    <div class="container">
      <header class="card">
        <div class="content" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
          <div>
            <div class="pill">Demo</div>
            <h1 style="margin:6px 0 4px; font-size:28px;">ìŒì„± ì¸ì‹ í‚¤ì˜¤ìŠ¤í¬</h1>
            <div class="hint">"ì•„ì´ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸ ë‘ ì”", "ë”°ëœ»í•œ ë¼ë–¼ í•˜ë‚˜", "ì£¼ë¬¸ ì™„ë£Œ" ì²˜ëŸ¼ ë§í•´ë³´ì„¸ìš”.</div>
          </div>
          <div class="center">
            <button id="btnStart" class="primary" aria-pressed="false">ğŸ™ï¸ ì¸ì‹ ì‹œì‘</button>
            <button id="btnStop">â¹ï¸ ì¸ì‹ ì •ì§€</button>
            <button id="btnClear" class="danger">ğŸ§¹ ì´ˆê¸°í™”</button>
          </div>
        </div>
      </header>
  
      <div class="grid" style="margin-top:18px;">
        <section class="card">
          <h2>ë©”ë‰´</h2>
          <div class="content">
            <div class="menu" id="menu"><div class="item"><div class="name">ì•„ë©”ë¦¬ì¹´ë…¸</div><div class="desc">3,000ì› Â· ì»¤í”¼, ê¸°ë³¸</div></div><div class="item"><div class="name">ë¼ë–¼</div><div class="desc">3,800ì› Â· ì»¤í”¼, ìš°ìœ </div></div><div class="item"><div class="name">ì¹´í‘¸ì¹˜ë…¸</div><div class="desc">4,000ì› Â· ì»¤í”¼</div></div><div class="item"><div class="name">ëª¨ì¹´</div><div class="desc">4,200ì› Â· ì´ˆì½”</div></div><div class="item"><div class="name">ë…¹ì°¨</div><div class="desc">3,500ì› Â· í‹°</div></div><div class="item"><div class="name">ì•„ì´ìŠ¤í‹°</div><div class="desc">3,200ì› Â· í‹°, ì‹œì›</div></div></div>
            <div class="footer">íƒ­í•´ì„œ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì„ ìˆ˜ë„ ìˆì–´ìš”.</div>
          </div>
        </section>
  
        <section class="card">
          <h2>ìŒì„± ì¸ì‹ &amp; ìƒíƒœ</h2>
          <div class="content">
            <div class="asr-box" aria-live="polite">
              <div class="label">ì‹¤ì‹œê°„ ì¸ì‹ê²°ê³¼</div>
              <div id="asrText" class="text"></div>
            </div>
            <div id="asrStatus" class="status " style="margin-top:8px;">ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•˜ë©´ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”. "ì¸ì‹ ì‹œì‘"ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
            <div style="margin-top:12px" class="hint">
              â€¢ í‚¤ì›Œë“œ: ì•„ì´ìŠ¤/ëœ¨ê±°ìš´, ìŠ¤ëª°/ë¯¸ë””ì—„/ë¼ì§€, ê°œìˆ˜(í•˜ë‚˜Â·ë‘˜Â·ì…‹ / 1Â·2Â·3).<br>
              â€¢ ì œì–´: "ì·¨ì†Œ"(ìµœê·¼ í•­ëª© ì‚­ì œ), "ë‹¤ì‹œ"(ì „ì²´ ë¹„ìš°ê¸°), "ì£¼ë¬¸ ì™„ë£Œ"(í™•ì •).
            </div>
          </div>
        </section>
      </div>
  
      <section class="card" style="margin-top:18px;">
        <h2>ì¥ë°”êµ¬ë‹ˆ</h2>
        <div class="content">
          <div style="overflow:auto;">
            <table>
              <thead>
                <tr>
                  <th>ë©”ë‰´</th><th>ì˜µì…˜</th><th>ìˆ˜ëŸ‰</th><th>ê°€ê²©</th><th></th>
                </tr>
              </thead>
              <tbody id="cartBody"></tbody>
              <tfoot>
                <tr>
                  <td colspan="3" style="text-align:right">í•©ê³„</td>
                  <td id="sumCell">0ì›</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          </div>
          <div class="toolbar" style="margin-top:12px;justify-content:flex-end;">
            <button id="btnCheckout" class="primary">âœ… ì£¼ë¬¸ ì™„ë£Œ</button>
          </div>
          <div id="checkoutMsg" class="status" style="margin-top:8px"></div>
        </div>
      </section>
  
      <footer class="container" style="opacity:.7; text-align:center;">
        <div class="footer">ë¸Œë¼ìš°ì €ëŠ” Chrome(ì•ˆë“œë¡œì´ë“œ/ë°ìŠ¤í¬í†±)ì—ì„œ ê°€ì¥ ì˜ ë™ì‘í•©ë‹ˆë‹¤. iOS SafariëŠ” ì œí•œì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
      </footer>
    </div>
  
    <script>
      /********************** ë©”ë‰´ êµ¬ì„± *************************/
      const MENU = [
        { id:'americano', name:'ì•„ë©”ë¦¬ì¹´ë…¸', price: 3000, tags:['ì»¤í”¼','ê¸°ë³¸'] },
        { id:'latte', name:'ë¼ë–¼', price: 3800, tags:['ì»¤í”¼','ìš°ìœ '] },
        { id:'cappuccino', name:'ì¹´í‘¸ì¹˜ë…¸', price: 4000, tags:['ì»¤í”¼'] },
        { id:'mocha', name:'ëª¨ì¹´', price: 4200, tags:['ì´ˆì½”'] },
        { id:'greentea', name:'ë…¹ì°¨', price: 3500, tags:['í‹°'] },
        { id:'icetea', name:'ì•„ì´ìŠ¤í‹°', price: 3200, tags:['í‹°','ì‹œì›'] },
      ];
  
      const SIZES = ['ìŠ¤ëª°','ë¯¸ë””ì—„','ë¼ì§€'];
      const TEMPS = ['ì•„ì´ìŠ¤','ëœ¨ê±°ìš´','ë”°ëœ»í•œ','í•«','ì°¨ê°€ìš´','ice','hot'];
  
      const numberWords = {
        'í•œì”':'1','í•œ ê°œ':'1','í•˜ë‚˜':'1','í•œ':'1','ë‘ì”':'2','ë‘ ê°œ':'2','ë‘˜':'2','ë‘':'2','ì„¸ì”':'3','ì„¸ ê°œ':'3','ì…‹':'3','ì„¸':'3','ë„¤':'4','ë‹¤ì„¯':'5','ì—¬ì„¯':'6','ì¼ê³±':'7','ì—¬ëŸ':'8','ì•„í™‰':'9','ì—´':'10'
      };
  
      function renderMenu(){
        const box = document.getElementById('menu');
        box.innerHTML = '';
        MENU.forEach(m => {
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `<div class="name">${m.name}</div><div class="desc">${m.price.toLocaleString()}ì› Â· ${m.tags.join(', ')}</div>`;
          div.addEventListener('click', () => addToCart({name:m.name, qty:1, size:'ë¯¸ë””ì—„', temp:'ì•„ì´ìŠ¤', price:m.price}));
          box.appendChild(div);
        });
      }
  
      /********************** ì¥ë°”êµ¬ë‹ˆ *************************/
      let cart = [];
  
      function addToCart(item){
        cart.push(item); renderCart(); speak(`${item.temp||''} ${item.size||''} ${item.name} ${item.qty}ê°œ ë‹´ì•˜ì–´ìš”`.replace(/\s+/g,' ').trim());
      }
  
      function removeFromCart(idx){ cart.splice(idx,1); renderCart(); }
  
      function clearCart(){ cart = []; renderCart(); }
  
      function renderCart(){
        const body = document.getElementById('cartBody');
        body.innerHTML = '';
        let sum = 0;
        cart.forEach((c, i) => {
          const tr = document.createElement('tr');
          const price = c.price * c.qty; sum += price;
          tr.innerHTML = `
            <td>${c.name}</td>
            <td>${(c.temp||'') + ' ' + (c.size||'')}</td>
            <td>${c.qty}</td>
            <td>${price.toLocaleString()}ì›</td>
            <td><button aria-label="ì‚­ì œ" onclick="removeFromCart(${i})">ì‚­ì œ</button></td>`;
          body.appendChild(tr);
        });
        document.getElementById('sumCell').textContent = sum.toLocaleString() + 'ì›';
      }
  
      /********************** ìŒì„±í•©ì„± *************************/
      function speak(text){
        try{
          const u = new SpeechSynthesisUtterance(text);
          u.lang = 'ko-KR';
          u.rate = 1.0; u.pitch = 1.0; u.volume = 1.0;
          window.speechSynthesis.cancel();
          window.speechSynthesis.speak(u);
        }catch(e){ /* no-op */ }
      }
  
      /********************** ìŒì„±ì¸ì‹ *************************/
      const asrText = document.getElementById('asrText');
      const asrStatus = document.getElementById('asrStatus');
  
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      let rec = null; let listening = false; let interim = '';
  
      function updateStatus(msg, cls=''){
        asrStatus.textContent = msg; asrStatus.className = 'status ' + cls;
      }
  
      function parseAndApply(text){
        const norm = text.replace(/\s+/g,'').toLowerCase();
  
        // ì œì–´ ëª…ë ¹
        if(/(ì£¼ë¬¸ì™„ë£Œ|ê²°ì œ|í™•ì •)/.test(norm)) { checkout(); return; }
        if(/(ë‹¤ì‹œ|ì´ˆê¸°í™”|ë¹„ìš°)/.test(norm)) { clearCart(); speak('ì¥ë°”êµ¬ë‹ˆë¥¼ ë¹„ì› ì–´ìš”'); return; }
        if(/(ì·¨ì†Œ|ì§€ì›Œ|ì‚­ì œ)/.test(norm)) { if(cart.length){ cart.pop(); renderCart(); speak('ë§ˆì§€ë§‰ í•­ëª©ì„ ì§€ì› ì–´ìš”'); } return; }
  
        // ìˆ˜ëŸ‰
        let qtyMatch = text.match(/(\d+|í•œì”|í•œ ê°œ|í•˜ë‚˜|í•œ|ë‘ì”|ë‘ ê°œ|ë‘˜|ë‘|ì„¸ì”|ì„¸ ê°œ|ì…‹|ì„¸|ë„¤|ë‹¤ì„¯|ì—¬ì„¯|ì¼ê³±|ì—¬ëŸ|ì•„í™‰|ì—´)/);
        let qty = 1;
        if(qtyMatch){
          const q = qtyMatch[1];
          qty = isNaN(Number(q)) ? Number(numberWords[q] || '1') : Number(q);
          if(qty <= 0) qty = 1; if(qty > 20) qty = 20;
        }
  
        // ì‚¬ì´ì¦ˆ & ì˜¨ë„
        let size = SIZES.find(s => text.includes(s)) || 'ë¯¸ë””ì—„';
        let temp = null;
        if(/(ì•„ì´ìŠ¤|ice|ì°¨ê°‘)/i.test(text)) temp = 'ì•„ì´ìŠ¤';
        else if(/(ëœ¨ê±°ìš´|ë”°ëœ»|í•«|hot)/i.test(text)) temp = 'ëœ¨ê±°ìš´';
  
        // ë©”ë‰´ëª…
        const found = MENU.find(m => text.includes(m.name));
        if(found){
          addToCart({ name: found.name, qty, size, temp: temp || 'ì•„ì´ìŠ¤', price: found.price });
          return;
        }
  
        // ëª¨í˜¸í•œ ê²½ìš° ê°„ë‹¨ í”¼ë“œë°±
        updateStatus('ë©”ë‰´ë¥¼ ëª» ì•Œì•„ë“¤ì—ˆì–´ìš”. ë‹¤ì‹œ ë§ì”€í•´ ì£¼ì„¸ìš” (ì˜ˆ: ì•„ì´ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸ ë‘ ì”).', 'warn');
        speak('ë©”ë‰´ë¥¼ ë‹¤ì‹œ ë§ì”€í•´ ì£¼ì„¸ìš”. ì˜ˆ, ì•„ì´ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸ ë‘ ì”');
      }
  
      function setupASR(){
        if(!SR){ updateStatus('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'err'); return; }
        rec = new SR();
        rec.lang = 'ko-KR';
        rec.continuous = true; // ì—°ì† ì¸ì‹
        rec.interimResults = true; // ì¤‘ê°„ ê²°ê³¼
  
        rec.onstart = () => { listening = true; updateStatus('ì¸ì‹ ì¤‘â€¦ í‰ì†Œ ë§í•˜ë“¯ ë§ì”€í•˜ì„¸ìš”.', 'ok'); document.getElementById('btnStart').setAttribute('aria-pressed','true'); };
        rec.onerror = (e) => { updateStatus('ì˜¤ë¥˜: ' + e.error, 'err'); };
        rec.onend = () => {
          listening = false; document.getElementById('btnStart').setAttribute('aria-pressed','false');
          updateStatus('ì¸ì‹ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.', '');
        };
  
        rec.onresult = (ev) => {
          let finalText = '';
          interim = '';
          for(let i = ev.resultIndex; i < ev.results.length; i++){
            const r = ev.results[i];
            if(r.isFinal) finalText += r[0].transcript;
            else interim += r[0].transcript;
          }
          asrText.textContent = (finalText || interim).trim();
          if(finalText){
            parseAndApply(finalText.trim());
          }
        };
      }
  
      function startASR(){ if(!rec){ setupASR(); } try{ rec && rec.start(); }catch(e){ /* ignore */ } }
      function stopASR(){ try{ rec && rec.stop(); }catch(e){ /* ignore */ } }
  
      /********************** ì£¼ë¬¸ ì™„ë£Œ *************************/
      function checkout(){
        if(!cart.length){ updateStatus('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆì–´ìš”.', 'warn'); speak('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆì–´ìš”'); return; }
        const sum = cart.reduce((a,c)=>a+c.price*c.qty,0);
        const msg = `ì´ ${sum.toLocaleString()}ì›ì…ë‹ˆë‹¤. ê²°ì œí•˜ì‹œê² ì–´ìš”?`;
        document.getElementById('checkoutMsg').textContent = msg;
        updateStatus('ì£¼ë¬¸ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ì œë¥¼ ì§„í–‰í•˜ì„¸ìš”.', 'ok');
        speak(msg);
      }
  
      /********************** ì´ë²¤íŠ¸ ë°”ì¸ë”© *************************/
      document.getElementById('btnStart').addEventListener('click', startASR);
      document.getElementById('btnStop').addEventListener('click', stopASR);
      document.getElementById('btnClear').addEventListener('click', () => { clearCart(); speak('ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤'); });
      document.getElementById('btnCheckout').addEventListener('click', checkout);
  
      // ì´ˆê¸° ë Œë”
      renderMenu();
      setupASR();
      updateStatus('ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•˜ë©´ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”. "ì¸ì‹ ì‹œì‘"ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
    </script>
  
  
  </body></html>